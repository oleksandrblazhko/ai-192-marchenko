## Варіант 18

## Узагальнення

HTTP пропонує ряд методів, які можна використовувати для виконання дій на веб-сервері (стандарт HTTP 1.1 називає їх **методами**, але їх також часто описують як **дієслова**). Хоча GET і POST є найпоширенішими методами, які використовуються для доступу до інформації, що надається веб-сервером, HTTP дозволяє використовувати ще кілька інших (і дещо менш відомих) методів. Деякі з них можуть бути використані в зловмисних цілях, якщо веб-сервер неправильно налаштований.

RFC 7231 - Протокол передачі гіпертексту (HTTP/1.1): Семантика і зміст визначає наступні допустимі методи запитів HTTP, або дієслова:

- **GET**
- **HEAD**
- **POST**
- **PUT**
- **DELETE**
- **CONNECT**
- **OPTIONS**
- **TRACE**

Більшість веб-додатків повинні відповідати лише на GET і POST запити, отримуючи дані користувача в рядку запиту URL-адреси або додаючи їх до запиту відповідно. Стандартні посилання у стилі **`<a href=""></a>`**
, а також форми, визначені без методу, викликають GET-запит; дані форми, передані через **`<form method='POST'></form>`**
, викликають POST-запити. Виклики JavaScript і AJAX можуть надсилати інші методи, крім GET і POST, але зазвичай не повинні цього робити. Оскільки інші методи використовуються дуже рідко, багато розробників не знають або не беруть до уваги, як реалізація цих методів на веб-сервері або фреймворку додатку впливає на безпеку додатку.

## Тестові задачі
- Перерахувати підтримувані методи HTTP.
- Тест на обхід контролю доступу.
- Перевірка XST уразливостей.
- Тестування методів перевизначення HTTP-методів.

## Як протестувати
### Знайти підтримувані методи
Щоб виконати цей тест, тестувальнику потрібно з'ясувати, які методи HTTP підтримуються веб-сервером, що перевіряється. Хоча HTTP-метод **OPTIONS** надає прямий спосіб зробити це, перевірте відповідь сервера, надсилаючи запити з використанням різних методів. Цього можна досягти за допомогою ручного тестування або чогось на кшталт скрипта **http-methods** Nmap.

Щоб використовувати Nmap-скрипт **http-methods** для тестування кінцевої точки **/index.php** на сервері **localhost** за допомогою HTTPS, виконайте команду:

**`nmap -p 443 --script http-methods --script-args http-methods.url-path='/index.php' localhost`**

Тестуючи додаток, який повинен приймати інші методи, наприклад, RESTful веб-сервіс, ретельно протестуйте його, щоб переконатися, що всі кінцеві точки приймають тільки ті методи, які їм потрібні.

## Тестування методу PUT

- Перехопіть базовий запит цілі за допомогою веб-проксі.
- Змініть метод запиту на **PUT**, додайте файл **test.html** і надішліть запит на сервер додатків.

```markdown
PUT /test.html HTTP/1.1
Host: testing-website

<html>
HTTP PUT Method is Enabled
</html>
```

- Якщо сервер відповідає 2XX кодів успіху або 3XX перенаправлень, а потім підтверджує **GET** запит на файл **test.html**. Додаток вразливий.
Якщо метод HTTP **PUT** заборонено для базової URL-адреси або запиту, спробуйте інші шляхи в системі.

ПРИМІТКА: Якщо вам вдалося завантажити веб-оболонку, ви повинні перезаписати її або переконатися, що команда безпеки цільової системи знає про це і видалити компонент негайно після перевірки концепції.

Використовуючи метод **PUT**, зловмисник може розмістити в системі довільний і потенційно шкідливий вміст, що може призвести до віддаленого виконання коду, пошкодження сайту або відмови в обслуговуванні.

### Тестування на обхід контролю доступу
Знайдіть сторінку, яка має такі обмеження безпеки, що GET-запит зазвичай призводить до перенаправлення 302 на сторінку входу в систему або до прямого входу в систему. Надсилайте запити, використовуючи різні методи, такі як HEAD, POST, PUT тощо, а також довільно створені методи, такі як BILBAO, FOOBAR, CATS тощо. Якщо веб-додаток відповідає **HTTP/1.1 200 OK**, що не є сторінкою входу в систему, можливо, є можливість обійти автентифікацію або авторизацію. У наступному прикладі використовується **ncat* від Nmap.

```
$ ncat www.example.com 80
HEAD /admin HTTP/1.1
Host: www.example.com

HTTP/1.1 200 OK
Date: Mon, 18 Aug 2008 22:44:11 GMT
Server: Apache
Set-Cookie: PHPSESSID=pKi...; path=/; HttpOnly
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Set-Cookie: adminOnlyCookie1=...; expires=Tue, 18-Aug-2009 22:44:31 GMT; domain=www.example.com
Set-Cookie: adminOnlyCookie2=...; expires=Mon, 18-Aug-2008 22:54:31 GMT; domain=www.example.com
Set-Cookie: adminOnlyCookie3=...; expires=Sun, 19-Aug-2007 22:44:30 GMT; domain=www.example.com
Content-Language: EN
Connection: close
Content-Type: text/html; charset=ISO-8859-1
```
Якщо система здається вразливою, проведіть CSRF-подібні атаки, такі як наведені нижче, щоб використати цю проблему повною мірою:

```
HEAD /admin/createUser.php?member=myAdmin
PUT /admin/changePw.php?member=myAdmin&passwd=foo123&confirm=foo123
CATS /admin/groupEdit.php?group=Admins&member=myAdmin&action=add
```
Використовуючи вищезгадані три команди, модифіковані відповідно до програми, що тестується, та вимог тестування, створюється новий користувач, йому призначається пароль, і він стає адміністратором, і все це з використанням сліпого надсилання запиту.

### Тестування потенціалу міжсайтового трасування
Примітка: для того, щоб зрозуміти логіку і цілі атаки міжсайтового трасування (XST), необхідно бути знайомим з міжсайтовими скриптовими атаками.

Метод **TRACE**, призначений для тестування і налагодження, дає веб-серверу вказівку відобразити отримане повідомлення назад клієнту. Цей метод, хоча і здається нешкідливим, може бути успішно використаний в деяких сценаріях для крадіжки облікових даних легітимних користувачів. Цю техніку атаки відкрив Джеремайя Гроссман у 2003 році, намагаючись обійти атрибут HttpOnly, який має на меті захистити файли cookie від доступу до них через JavaScript. Однак, метод TRACE може бути використаний для обходу цього захисту і отримання доступу до файлу cookie, навіть якщо цей атрибут встановлений.

Перевірте можливість міжсайтового відстеження, відправивши запит, подібний до наступного:\

- **X-HTTP-Method**
- **X-HTTP-Method-Override**
- **X-Method-Override**

Щоб перевірити це, у сценаріях, де обмежені дієслова, такі як PUT або DELETE, повертають "405 Метод не дозволений", відтворіть той самий запит з додаванням альтернативних заголовків для перевизначення HTTP-методу і подивіться, як система реагує на нього. Додаток повинен відповісти іншим кодом статусу (наприклад, 200) у випадках, коли перевизначення методів підтримується.

У наступному прикладі веб-сервер не дозволяє використовувати метод **DELETE** і блокує його:

```
$ ncat www.example.com 80
DELETE /resource.html HTTP/1.1
Host: www.example.com

HTTP/1.1 405 Method Not Allowed
Date: Sat, 04 Apr 2020 18:26:53 GMT
Server: Apache
Allow: GET,HEAD,POST,OPTIONS
Content-Length: 320
Content-Type: text/html; charset=iso-8859-1
Vary: Accept-Encoding
```

Після додавання **X-HTTP-Header** сервер відповідає на запит 200:

```
$ ncat www.example.com 80
DELETE /resource.html HTTP/1.1
Host: www.example.com
X-HTTP-Method: DELETE

HTTP/1.1 200 OK
Date: Sat, 04 Apr 2020 19:26:01 GMT
Server: Apache
```

## Виправлення
- Переконайтеся, що дозволені лише необхідні заголовки і що дозволені заголовки налаштовані належним чином.
- Переконайтеся, що не реалізовано обхідних шляхів для обходу заходів безпеки, реалізованих користувацькими агентами, фреймворками або веб-серверами.